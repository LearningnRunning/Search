.PHONY: help install dev-install run format lint type-check test clean

# ê¸°ë³¸ íƒ€ê²Ÿ
help: ## ë„ì›€ë§ í‘œì‹œ
	@echo "ğŸ½ï¸ ìŒì‹ì  ê²€ìƒ‰ ì‹œìŠ¤í…œ - ì‚¬ìš© ê°€ëŠ¥í•œ ëª…ë ¹ì–´:"
	@echo ""
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | sort | awk 'BEGIN {FS = ":.*?## "}; {printf "\033[36m%-20s\033[0m %s\n", $$1, $$2}'

# ì„¤ì¹˜ ê´€ë ¨
install: ## í”„ë¡œë•ì…˜ ì˜ì¡´ì„± ì„¤ì¹˜
	uv sync

dev-install: ## ê°œë°œ ì˜ì¡´ì„± í¬í•¨ ì„¤ì¹˜
	uv sync --dev

# ì‹¤í–‰
run: ## Streamlit ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰
	uv run streamlit run src/app.py

# ì½”ë“œ í’ˆì§ˆ
format: ## ì½”ë“œ í¬ë§·íŒ…
	uv run ruff format .

lint: ## ì½”ë“œ ë¦°íŒ…
	uv run ruff check .

type-check: ## íƒ€ì… ì²´í¬
	uv run mypy src/

check: format lint type-check ## ëª¨ë“  ì½”ë“œ í’ˆì§ˆ ê²€ì‚¬ ì‹¤í–‰

# í…ŒìŠ¤íŠ¸
test: ## í…ŒìŠ¤íŠ¸ ì‹¤í–‰
	uv run pytest

test-cov: ## ì»¤ë²„ë¦¬ì§€ í¬í•¨ í…ŒìŠ¤íŠ¸
	uv run pytest --cov=src --cov-report=html

# íŒ¨í‚¤ì§€ ê´€ë¦¬
add: ## íŒ¨í‚¤ì§€ ì¶”ê°€ (ì‚¬ìš©ë²•: make add PKG=package_name)
	uv add $(PKG)

add-dev: ## ê°œë°œ íŒ¨í‚¤ì§€ ì¶”ê°€ (ì‚¬ìš©ë²•: make add-dev PKG=package_name)
	uv add --dev $(PKG)

remove: ## íŒ¨í‚¤ì§€ ì œê±° (ì‚¬ìš©ë²•: make remove PKG=package_name)
	uv remove $(PKG)

tree: ## ì˜ì¡´ì„± íŠ¸ë¦¬ í‘œì‹œ
	uv tree

# ì •ë¦¬
clean: ## ìºì‹œ ë° ì„ì‹œ íŒŒì¼ ì •ë¦¬
	find . -type d -name "__pycache__" -exec rm -rf {} +
	find . -type f -name "*.pyc" -delete
	find . -type f -name "*.pyo" -delete
	find . -type f -name "*.pyd" -delete
	find . -type d -name "*.egg-info" -exec rm -rf {} +
	find . -type d -name ".pytest_cache" -exec rm -rf {} +
	find . -type d -name ".mypy_cache" -exec rm -rf {} +
	rm -rf .coverage htmlcov/

# ì˜ì¡´ì„± ë‚´ë³´ë‚´ê¸°
export-prod: ## í”„ë¡œë•ì…˜ìš© requirements.txt ìƒì„±
	uv export --no-dev --format requirements.txt > requirements.txt

export-dev: ## ê°œë°œìš© requirements.txt ìƒì„±
	uv export --format requirements.txt > requirements.txt

# ê°œë°œ í™˜ê²½ ì„¤ì •
setup: ## ê°œë°œ í™˜ê²½ ì´ˆê¸° ì„¤ì •
	@echo "ğŸ½ï¸ ê°œë°œ í™˜ê²½ì„ ì„¤ì •í•©ë‹ˆë‹¤..."
	@chmod +x scripts/setup.sh
	@chmod +x scripts/check_python_version.sh
	@./scripts/setup.sh

check-python: ## Python ë²„ì „ í™•ì¸
	@chmod +x scripts/check_python_version.sh
	@./scripts/check_python_version.sh 